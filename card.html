<head>
    <title>mObywatel</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/card.css?v=1.2">
    <link rel="stylesheet" href="assets/main.css">
    <link rel="icon" type="image/x-icon" href="images/otM5jOA.png">
    <link rel="apple-touch-icon" href="images/otM5jOA.png">
    <link rel="shortcut icon" href="images/otM5jOA.png">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
        .circle-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 24px;
        }
        .circle-button {
            background-color: #2c2c2c;
            border-radius: 50%;
            width: 72px;
            height: 72px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            text-align: center;
            border: 1px solid #444;
        }
        .circle-button span {
            margin-top: 6px;
        }

        .box_value, .box_value1{
            font-size: 1rem;
            font-weight: 500;
            color: #1f2125;
            margin: 0;
            padding: 0;

        }

        .services_grid {
            display: flex;
            justify-content: flex-start; /* lub space-between */
            flex-wrap: nowrap;
            gap: 5px;
            width: 100%;
            margin: 0 auto;
            padding: 5px;
            overflow-x: auto; /* POZWALA przewijać poziomo na małych ekranach */
            max-width: auto;
            float: left;
            padding-bottom: 0px;
        }


        .service_box {
            flex: 1 1 20%;
            min-width: 0px;
            max-width: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
            padding-bottom: 0px;
        }

        .service_box_icon {
            width: 30px;
            height: 30px;
            object-fit: contain;
            margin-bottom: 10px;
            border-radius: 20px;
            padding: 10px;
            background-color: white;
            margin: 0px;
        }


        .service_box_name {
            font-size: 12px;
            font-weight: 600;
            color: #1f2125;
            line-height: 1.2;
            min-height: 3em; /* zapewnia równe wysokości tekstu */
            padding-bottom: 0px;
        }

        .confirm_box{
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .other_grid{
            padding-top: auto;
        }

        /* Poprawiono style dla holograficznego orła - zmniejszono rozmiar i usunięto obrócenie */
        .holographic-eagle-container {
            position: absolute;
            width: 42px;
            height: 53px;
            top: 304px; /* Przesunięto znacznie niżej */
            left: 33px; /* Wyśrodkowano */
        }

        #hologramCanvas {
            width: 42px;
            height: 53px;
            display: block;
            /* Usunięto transform: scaleY(-1) */
        }
    </style>
</head>
<body>
    <div class="top_grid">
        <div class="action_grid">
            <img src="images/BDZT6fX.png" class="back_img">
            <p onclick="sendTo('home')" class="back_text">Wróć</p>
        </div>
        <p class="title_text">mDowód</p>
        <img src="images/pomoctechniczna2.png" class="help_img" style="width: 20px;">
    </div>

    <div class="bottom_bar">
        <div class="bottom_bar_grid">
            <div class="bottom_element_grid" send="home">
                <div class="bottom_element_image home_open"></div>
                <p class="bottom_element_text">Pulpit</p>
            </div>
            <div class="bottom_element_grid" send="documents">
                <div class="bottom_element_image documents"></div>
                <p class="bottom_element_text open">Dokumenty</p>
            </div>
            <div class="bottom_element_grid" send="services">
                <div class="bottom_element_image services"></div>
                <p class="bottom_element_text">Usługi</p>
            </div>
            <div class="bottom_element_grid" send="qr">
                <div class="bottom_element_image qr"></div>
                <p class="bottom_element_text">Kod QR</p>
            </div>
            <div class="bottom_element_grid" send="more">
                <div class="bottom_element_image more"></div>
                <p class="bottom_element_text">Więcej</p>
            </div>
        </div>
    </div>
    <p class="time_text" id="time"></p>
    <div class="id_image_data">
        <img draggable="false" class="id_image" src="images/XSZFxrl.png">
        <div class="inset">

        </div>
        <div class="id_own_image" style="background-image: url('https://i.imgur.com/7vHo48p.jpg');"></div>
        <img draggable="false" src="images/gzot1Pt.gif" class="flag_video">
        
        <!-- Zastąpiono GIF orła holograficznym orłem z 5 warstwami -->
        <div class="holographic-eagle-container eagle_video" id="holographicEagle">
            <canvas id="hologramCanvas" class="eagle_video"></canvas>
        </div>
        
        <p class="eagle_text">Rzeczpospolita<br>Polska</p>
        <div class="id_data_grid">
            <div class="data_holder">
                <p class="data_title firstname" id="name"></p>
                <p class="data_value">Imię (imiona)</p>
            </div>
            <div class="data_holder">
                <p class="data_title surname" id="surname"></p>
                <p class="data_value">Nazwisko</p>
            </div>
            <div class="data_holder">
                <p class="data_title" id="nationality"></p>
                <p class="data_value">Obywatelstwo</p>
            </div>
            <div class="data_holder">
                <p class="data_title" id="birthday"></p>
                <p class="data_value">Data urodzenia</p>
            </div>
            <div class="data_holder">
                <p class="data_title" id="pesel"></p>
                <p class="data_value">Numer PESEL</p>
            </div>
        </div>
    </div>
    <div class="id_bottom">
        <div class="bottom_grid">
            <img class="bottom_image" src="images/7S4kQGf.png">
            <p class="bottom_text" style="color: #317C26; font-size: 17px;">Dokument ważny</p>
        </div>
    </div>

    <div class="services_grid" style="height: auto; width: auto;">
        <div class="service_box">
            <img class="service_box_icon" id="1" src="images/Pfan6Qa.png" onclick="sendTo('qr2')">
            <p class="service_box_name">Potwierdź swoje dane</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" id="2" src="images/KUMNgQC.png" onclick="sendTo('dane')">
            <p class="service_box_name" style="width: 100px;">Dane dowodu <br>osobistego</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" id="3" src="images/pobrane.png" onclick="sendTo('zastzrzez')">
            <p class="service_box_name">Zastrzeż <br>PESEL</p>
        </div>
        <div class="service_box">
            <img class="service_box_icon" id="4" src="images/ECjKGrW2.png" onclick="sendTo('pozostałe')">
            <p class="service_box_name">Pozostałe skróty</p>
        </div>
    </div>
    
    <div class="other_grid" style="margin-top: 0px;">
        <!-- Pierwszy bottom_holder z tabelką z danymi dokumentu -->
        <div class="bottom_holder" style="height: auto">
            
                <!-- Seria i numer -->
                <div class="confirm_box" style="border: none;">
                    <p class="box_top">Seria i numer</p>
                    <b><p class="box_value" id="seria_numer" style="font-size: 25px;"></p></b>
                    <button class="main_button">Kopiuj</button>
                </div>
                <!-- Organ wydający -->
                <div class="confirm_box">
                    <p class="box_top">Termin ważności</p>
                    <b><p class="box_value" id="waznosc" style="font-size: 22px;"></p></b>
                </div>
                <!-- Termin ważności -->
                <div class="confirm_box">
                    <p class="box_top">Data wydania</p>
                    <b><p class="box_value" id="wydany" style="font-size: 22px;"></p></b>
                </div>
                <div class="confirm_box">
                    <p class="box_top">Imię ojca</p>
                    <b><p class="box_value" id="fatherName" style="font-size: 22px;"></p></b>
                </div>
                <div class="confirm_box">
                    <p class="box_top">Imię matki</p>
                    <b><p class="box_value" id="motherName" style="font-size: 22px;"></p></b>
                </div>
        </div>
        
    
        <!-- Drugi bottom_holder (rozwijany) -->
        <div class="bottom_holder info_holder" style="font-size: 20px;">
            <div class="bottom_grid">
                <p class="bottom_text" style="color: #1f2125; margin-left: 0px;">Twoje dodatkowe dane</p>
            </div>
            <img class="action_arrow" src="images/2aN0vJE.png">
            <div class="additional_holder">
                <div class="additional_grid">
                    <p class="additional_title">Nazwisko rodowe</p>
                    <p class="additional_subtitle" id="familyName"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Płeć</p>
                    <p class="additional_subtitle" id="sex"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Nazwisko rodowe ojca</p>
                    <p class="additional_subtitle" id="fathersFamilyName"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Nazwisko rodowe matki</p>
                    <p class="additional_subtitle" id="mothersFamilyName"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Miejsce urodzenia</p>
                    <p class="additional_subtitle" id="birthPlace"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Kraj urodzenia</p>
                    <p class="additional_subtitle" id="countryOfBirth"></p>
                </div>
                <div class="additional_grid">
                    <p class="additional_title">Adres zameldowania na pobyt stały</p>
                    <p class="additional_subtitle" id="adress"></p>
                </div>
                <div class="additional_grid" style="border-bottom: none;">
                    <p class="additional_title">Data zameldowania na pobyt stały</p>
                    <p class="additional_subtitle home_date"></p>
                </div>
            </div>
        </div>
    
        <!-- Trzeci bottom_holder z przyciskiem "Aktualizuj" -->
        <div class="bottom_holder" style="height: 90px; margin-bottom: 120px;">
            <div class="bottom_update">
                <div class="bottom_update_grid">
                    <p class="bottom_update_text" style="margin-left: 0px;">Ostatnia aktualizacja</p>
                    <p class="bottom_update_value" style="margin-left: 0px;"></p>
                </div>
                <button class="main_button update">Aktualizuj</button>
            </div>
        </div>
    </div>
    
    <script src="assets/bar.js"></script>
    <script src="assets/card.js?v=1.0"></script>
    <script src="assets/manifest.js"></script>

    <script>
        class HologramRenderer {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.gl = this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl');
                
                if (!this.gl) {
                    console.error('WebGL not supported');
                    return;
                }

                this.accelerometerCoords = [0.0, 0.0, 0.0];
                this.textures = {};
                this.program = null;
                
                this.init();
            }

            // Vertex shader z przesłanego kodu
            getVertexShaderSource() {
                return `
                    uniform mat4 u_MVPMatrix;
                    attribute vec4 a_VertexPosition;
                    attribute vec2 a_TextureCoordinates;
                    uniform vec3 u_AccelerometerCoordinates;
                    varying vec2 v_TextureCoordinates;
                    varying vec2 v_AccelerometerCoordinates;
                    
                    void main() {
                        gl_Position = u_MVPMatrix * a_VertexPosition;
                        v_TextureCoordinates = a_TextureCoordinates;
                        v_AccelerometerCoordinates = normalize(u_AccelerometerCoordinates).xy;
                    }
                `;
            }

            // Fragment shader z przesłanego kodu - poprawiono kolory
            getFragmentShaderSource() {
                return `
                    precision mediump float;
                    
                    uniform sampler2D u_BackgroundTexture;
                    uniform sampler2D u_HologramTexture;
                    uniform sampler2D u_HoloMapTexture;
                    uniform sampler2D u_EagleTexture;
                    
                    varying vec2 v_TextureCoordinates;
                    varying vec2 v_AccelerometerCoordinates;
                    
                    void main() {
                        vec2 redAccelerometerCoordinates = v_AccelerometerCoordinates + 0.1 * v_TextureCoordinates;
                        vec2 greenAccelerometerCoordinates = v_AccelerometerCoordinates + vec2(0.333, -0.333) + 0.1 * v_TextureCoordinates;
                        vec2 blueAccelerometerCoordinates = v_AccelerometerCoordinates + vec2(0.667, -0.667) + 0.1 * v_TextureCoordinates;
                        
                        vec3 backgroundColor = texture2D(u_BackgroundTexture, v_TextureCoordinates).rgb;
                        vec4 eagleColor = texture2D(u_EagleTexture, v_TextureCoordinates);
                        
                        vec3 redHologramColor = texture2D(u_HologramTexture, redAccelerometerCoordinates).rgb;
                        vec3 greenHologramColor = texture2D(u_HologramTexture, greenAccelerometerCoordinates).rgb;
                        vec3 blueHologramColor = texture2D(u_HologramTexture, blueAccelerometerCoordinates).rgb;
                        
                        vec4 holoMapColor = texture2D(u_HoloMapTexture, v_TextureCoordinates);
                        
                        // Oryginalny algorytm z mObywatel - backgroundWeight kontroluje przezroczystość
                        float backgroundWeight = 1.0 - min(1.0, holoMapColor.r + holoMapColor.g + holoMapColor.b);
                        
                        vec3 hologramColor =
                            holoMapColor.r * redHologramColor +
                            holoMapColor.g * greenHologramColor +
                            holoMapColor.b * blueHologramColor +
                            backgroundWeight * backgroundColor;
                        
                        // Mieszanie z podstawową teksturą orła - orzeł pozostaje widoczny, hologram jest nakładką
                        vec3 finalColor = eagleColor.rgb * (1.0 - holoMapColor.a * 0.5) + hologramColor * holoMapColor.a * 0.5;
                        
                        gl_FragColor = vec4(finalColor, eagleColor.a);
                    }
                `;
            }

            createShader(type, source) {
                const shader = this.gl.createShader(type);
                this.gl.shaderSource(shader, source);
                this.gl.compileShader(shader);
                
                if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {
                    console.error('Shader compilation error:', this.gl.getShaderInfoLog(shader));
                    this.gl.deleteShader(shader);
                    return null;
                }
                
                return shader;
            }

            createProgram() {
                const vertexShader = this.createShader(this.gl.VERTEX_SHADER, this.getVertexShaderSource());
                const fragmentShader = this.createShader(this.gl.FRAGMENT_SHADER, this.getFragmentShaderSource());
                
                const program = this.gl.createProgram();
                this.gl.attachShader(program, vertexShader);
                this.gl.attachShader(program, fragmentShader);
                this.gl.linkProgram(program);
                
                if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {
                    console.error('Program linking error:', this.gl.getProgramInfoLog(program));
                    return null;
                }
                
                return program;
            }

            loadTexture(url) {
                const texture = this.gl.createTexture();
                this.gl.bindTexture(this.gl.TEXTURE_2D, texture);
                
                // Placeholder pixel podczas ładowania
                this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, 1, 1, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, new Uint8Array([0, 0, 255, 255]));
                
                const image = new Image();
                image.crossOrigin = 'anonymous';
                image.onload = () => {
                    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);
                    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, image);
                    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);
                    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);
                    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);
                    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);
                };
                image.src = url;
                
                return texture;
            }

            init() {
                this.program = this.createProgram();
                if (!this.program) return;

                this.textures.background = this.loadTexture('pictures/hologram_background.webp');
                this.textures.hologram = this.loadTexture('pictures/hologram_overlay.webp');
                this.textures.holoMap = this.loadTexture('pictures/hologram_emblem_fake.png'); // Mapa hologramu
                this.textures.eagle = this.loadTexture('pictures/hologram_emblem_top.webp'); // Podstawowa tekstura orła

                const vertices = new Float32Array([
                    -1.0, -1.0, 0.0, 1.0,  // Lewy dolny - tekstura Y=1.0
                     1.0, -1.0, 1.0, 1.0,  // Prawy dolny - tekstura Y=1.0
                    -1.0,  1.0, 0.0, 0.0,  // Lewy górny - tekstura Y=0.0
                     1.0,  1.0, 1.0, 0.0   // Prawy górny - tekstura Y=0.0
                ]);

                this.vertexBuffer = this.gl.createBuffer();
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer);
                this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);

                // Atrybuty
                this.positionLocation = this.gl.getAttribLocation(this.program, 'a_VertexPosition');
                this.texCoordLocation = this.gl.getAttribLocation(this.program, 'a_TextureCoordinates');
                
                // Uniformy
                this.mvpMatrixLocation = this.gl.getUniformLocation(this.program, 'u_MVPMatrix');
                this.accelerometerLocation = this.gl.getUniformLocation(this.program, 'u_AccelerometerCoordinates');
                this.backgroundTextureLocation = this.gl.getUniformLocation(this.program, 'u_BackgroundTexture');
                this.hologramTextureLocation = this.gl.getUniformLocation(this.program, 'u_HologramTexture');
                this.holoMapTextureLocation = this.gl.getUniformLocation(this.program, 'u_HoloMapTexture');
                this.eagleTextureLocation = this.gl.getUniformLocation(this.program, 'u_EagleTexture'); // Dodano uniform dla tekstury orła

                this.render();
            }

            updateAccelerometer(x, y, z) {
                this.accelerometerCoords = [x, y, z];
            }

            render() {
                this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);
                this.gl.clear(this.gl.COLOR_BUFFER_BIT);

                this.gl.useProgram(this.program);

                // Bind vertex buffer
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer);
                
                // Position attribute
                this.gl.enableVertexAttribArray(this.positionLocation);
                this.gl.vertexAttribPointer(this.positionLocation, 2, this.gl.FLOAT, false, 16, 0);
                
                // Texture coordinate attribute
                this.gl.enableVertexAttribArray(this.texCoordLocation);
                this.gl.vertexAttribPointer(this.texCoordLocation, 2, this.gl.FLOAT, false, 16, 8);

                // MVP Matrix (identity dla 2D)
                const mvpMatrix = new Float32Array([
                    1, 0, 0, 0,
                    0, 1, 0, 0,
                    0, 0, 1, 0,
                    0, 0, 0, 1
                ]);
                this.gl.uniformMatrix4fv(this.mvpMatrixLocation, false, mvpMatrix);

                // Accelerometer coordinates
                this.gl.uniform3fv(this.accelerometerLocation, this.accelerometerCoords);

                // Bind textures
                this.gl.activeTexture(this.gl.TEXTURE0);
                this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures.background);
                this.gl.uniform1i(this.backgroundTextureLocation, 0);

                this.gl.activeTexture(this.gl.TEXTURE1);
                this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures.hologram);
                this.gl.uniform1i(this.hologramTextureLocation, 1);

                this.gl.activeTexture(this.gl.TEXTURE2);
                this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures.holoMap);
                this.gl.uniform1i(this.holoMapTextureLocation, 2);

                this.gl.activeTexture(this.gl.TEXTURE3);
                this.gl.bindTexture(this.gl.TEXTURE_2D, this.textures.eagle);
                this.gl.uniform1i(this.eagleTextureLocation, 3);

                // Draw
                this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);

                requestAnimationFrame(() => this.render());
            }
        }

        // Inicjalizacja WebGL hologramu
        let hologramRenderer;
        let isGyroscopeEnabled = false;

        function initHologram() {
            const canvas = document.getElementById('hologramCanvas');
            canvas.width = 84;  // 2x większa rozdzielczość
            canvas.height = 106; // 2x większa rozdzielczość
            hologramRenderer = new HologramRenderer('hologramCanvas');
        }

        // Funkcja do żądania pozwolenia na iOS
        function requestGyroscopePermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            isGyroscopeEnabled = true;
                            startGyroscope();
                        }
                    })
                    .catch(console.error);
            } else {
                isGyroscopeEnabled = true;
                startGyroscope();
            }
        }

        function startGyroscope() {
            window.addEventListener('deviceorientation', handleOrientation);
        }

        function handleOrientation(event) {
            if (!isGyroscopeEnabled || !hologramRenderer) return;

            const gamma = (event.gamma || 0) / 90.0; // Normalizacja do -1,1
            const beta = (event.beta || 0) / 90.0;
            const alpha = (event.alpha || 0) / 360.0;

            hologramRenderer.updateAccelerometer(gamma, beta, alpha);
        }

        // Uruchomienie po załadowaniu strony
        window.addEventListener('load', initHologram);

        // Uruchom żyroskop po kliknięciu (wymagane na iOS)
        document.addEventListener('click', function() {
            if (!isGyroscopeEnabled) {
                requestGyroscopePermission();
            }
        }, { once: true });

        // Automatyczne uruchomienie na Androidzie
        if (navigator.userAgent.toLowerCase().indexOf('android') > -1) {
            setTimeout(() => {
                isGyroscopeEnabled = true;
                startGyroscope();
            }, 1000);
        }
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        function generateSerialNumber() {
            const letters = Array.from({ length: 3 }, () =>
                String.fromCharCode(65 + Math.floor(Math.random() * 26))
            ).join('');
            const digits = Array.from({ length: 6 }, () =>
                Math.floor(Math.random() * 10)
            ).join('');
            return `${letters} ${digits}`;
        }

        function getRandomIssueDate() {
            const now = new Date();
            const past = new Date();
            past.setFullYear(now.getFullYear() - 1);
            const randomTime = past.getTime() + Math.random() * (now.getTime() - past.getTime());
            return new Date(randomTime);
        }

        function formatDate(date) {
            const d = String(date.getDate()).padStart(2, '0');
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const y = date.getFullYear();
            return `${d}.${m}.${y}`;
        }

        // 🔒 Pobierz dane z localStorage
        let serial = localStorage.getItem("seria_numer");
        let issueDate = localStorage.getItem("wydany");
        let expiryDate = localStorage.getItem("waznosc");

        // Jeśli brak → wygeneruj nowe i zapisz
        if (!serial || !issueDate || !expiryDate) {
            serial = generateSerialNumber();
            const issue = getRandomIssueDate();
            const expiry = new Date(issue);
            expiry.setFullYear(issue.getFullYear() + 10);

            issueDate = formatDate(issue);
            expiryDate = formatDate(expiry);

            localStorage.setItem("seria_numer", serial);
            localStorage.setItem("wydany", issueDate);
            localStorage.setItem("waznosc", expiryDate);
        }

        // 🖊️ Wstaw dane do strony
        document.getElementById("seria_numer").textContent = serial;
        document.getElementById("wydany").textContent = issueDate;
        document.getElementById("waznosc").textContent = expiryDate;
    });
</script>
</body>










